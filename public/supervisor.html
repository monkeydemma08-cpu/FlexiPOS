<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KANM - Panel de supervisión</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/styles.css" />
  <style>
    /* Modal Negocios */
    #kanm-negocios-modal {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #kanm-negocios-modal.oculto {
      display: none;
    }
    #kanm-negocios-modal {
      position: fixed;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #kanm-negocios-modal.oculto {
      display: none;
    }
    #kanm-negocios-modal .kanm-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
    }
    #kanm-negocios-modal .kanm-modal-panel {
      position: relative;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
      max-width: 560px;
      width: 90%;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      z-index: 1;
    }
    #kanm-negocios-modal .kanm-modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #kanm-negocios-modal .kanm-modal-body {
      padding: 16px 20px;
      overflow-y: auto;
    }

    @media (max-width: 768px) {
      #kanm-negocios-modal .kanm-modal-panel {
        max-width: 100%;
        width: 100%;
        border-radius: 0;
      }
    }
  </style>
</head>
<body data-role="supervisor">
  <header class="kanm-header">
    <div class="kanm-header-left">
      <div class="kanm-header-logo-container">
        <img id="kanm-header-logo" alt="" />
        <div id="kanm-header-logo-fallback" class="kanm-logo-fallback"></div>
      </div>
      <div class="kanm-header-texts">
        <div
          id="kanm-header-negocio-nombre-principal"
          class="kanm-header-title"
          data-negocio-titulo
        ></div>
        <div id="kanm-header-negocio-subtitulo" class="kanm-header-subtitle">Panel de supervisión</div>
      </div>
    </div>

    <div class="kanm-header-right">
      <div class="kanm-header-actions">
        <span class="tag-rol">Admin</span>
        <a class="kanm-button ghost chat-link" href="/chat.html">
          Chat interno
          <span id="chat-unread-badge" class="chat-unread-badge"></span>
        </a>
        <button type="button" class="kanm-button ghost" id="kanm-empresa-panel" hidden>Panel empresa</button>
        <button type="button" class="kanm-button ghost" onclick="logout()">Cerrar sesión</button>
      </div>
    </div>
  </header>

  <main class="admin-container">
    <div class="admin-tabs" id="admin-tabs">
      <button type="button" class="kanm-tab active" data-admin-tab="productos" data-modulo="admin">Inventario</button>
      <button type="button" class="kanm-tab" data-admin-tab="configuracion" data-modulo="admin">Configuración</button>
      <button type="button" class="kanm-tab" data-admin-tab="usuarios" data-modulo="admin">Usuarios</button>
      <button type="button" class="kanm-tab" data-admin-tab="categorias" data-modulo="admin">Categorías</button>
      <button type="button" class="kanm-tab" data-admin-tab="clientes" data-modulo="admin">Clientes</button>
      <button type="button" class="kanm-tab" data-admin-tab="cotizaciones" data-modulo="admin" data-tab-url="/supervisor/cotizaciones">
        Cotizaciones
      </button>
      <button type="button" class="kanm-tab" data-admin-tab="compras" data-modulo="admin">Compras &amp; 606</button>
      <button type="button" class="kanm-tab" data-admin-tab="abastecimiento" data-modulo="admin">Abastecimiento</button>
      <button type="button" class="kanm-tab" data-admin-tab="gastos" data-modulo="admin">Gastos</button>
      <button type="button" class="kanm-tab" data-admin-tab="ventas" data-modulo="caja">Ventas &amp; 607</button>
      <button type="button" class="kanm-tab" data-admin-tab="analisis" data-modulo="admin">Analisis del negocio</button>
      <button type="button" class="kanm-tab" data-admin-tab="cuadres" data-modulo="caja">Cuadres de caja</button>
      <button type="button" class="kanm-tab" data-admin-tab="historial" data-modulo="historialCocina">Historial de preparación</button>
      <button type="button" class="kanm-tab super-admin-only" data-admin-tab="negocios" data-modulo="admin">Negocios</button>
    </div>

    <!-- Productos -->
    <section class="admin-panel" data-admin-section="productos" id="admin-section-productos">
      <div class="kanm-card-header">
        <h2>Inventario</h2>
        <p class="kanm-subtitle">Consulta el inventario disponible para la venta.</p>
      </div>
      <div id="supervisor-inventario" class="supervisor-inventario-wrapper">
        <section class="kanm-card empresa-inventario-header">
          <div class="empresa-inventario-header-row">
            <div>
              <h2>Inventario</h2>
              <p class="kanm-subtitle">Vista de solo lectura para supervisión.</p>
            </div>
          </div>
          <div class="empresa-inventario-kpis">
            <div class="empresa-kpi">
              <span>Items en inventario</span>
              <strong id="supervisor-inventario-total">0</strong>
            </div>
            <div class="empresa-kpi">
              <span>Stock critico</span>
              <strong id="supervisor-inventario-critico">0</strong>
            </div>
            <div class="empresa-kpi">
              <span>Stock bajo</span>
              <strong id="supervisor-inventario-bajo">0</strong>
            </div>
            <div class="empresa-kpi">
              <span>Valor inventario</span>
              <strong id="supervisor-inventario-valor">RD$0.00</strong>
            </div>
          </div>
        </section>

        <section class="kanm-card empresa-inventario-layout">
          <div class="empresa-inventario-filtros">
            <div class="empresa-inventario-filtros-scroll">
              <div class="kanm-input-group">
                <label for="supervisor-inventario-buscar">Buscar</label>
                <input type="search" id="supervisor-inventario-buscar" placeholder="Nombre o categoria" />
              </div>
              <div class="kanm-input-group">
                <label for="supervisor-inventario-categoria">Categoria</label>
                <input type="text" id="supervisor-inventario-categoria" placeholder="Familia, linea, categoria" />
              </div>
              <div class="kanm-input-group">
                <label for="supervisor-inventario-tipo">Tipo</label>
                <select id="supervisor-inventario-tipo">
                  <option value="">Todos</option>
                  <option value="vendible">Vendible</option>
                  <option value="insumo">Insumo</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="supervisor-inventario-estado">Estado</label>
                <select id="supervisor-inventario-estado">
                  <option value="">Todos</option>
                  <option value="activo">Activo</option>
                  <option value="inactivo">Inactivo</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="supervisor-inventario-stock">Stock</label>
                <select id="supervisor-inventario-stock">
                  <option value="">Todos</option>
                  <option value="indefinido">Indefinido</option>
                  <option value="critico">Critico</option>
                  <option value="bajo">Bajo</option>
                  <option value="disponible">Disponible</option>
                </select>
              </div>
            </div>
            <div class="empresa-inventario-filtros-actions">
              <button type="button" class="kanm-button" id="supervisor-inventario-filtrar">Filtrar</button>
              <button type="button" class="kanm-button ghost" id="supervisor-inventario-limpiar">Limpiar</button>
            </div>
          </div>
          <div class="empresa-inventario-lista">
            <div class="empresa-inventario-lista-header">
              <div>
                <h3>Inventario</h3>
                <p class="kanm-subtitle">Stock, costos y precios en tiempo real.</p>
              </div>
            </div>
            <div class="kanm-table-wrapper empresa-inventario-table-scroll">
              <table class="kanm-table">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Categoria</th>
                    <th>Stock</th>
                    <th>Minimo</th>
                    <th>Costo</th>
                    <th>Precio</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody id="supervisor-inventario-body">
                  <tr>
                    <td colspan="7">Cargando...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="supervisor-inventario-mensaje" class="kanm-message"></div>
          </div>
        </section>
      </div>
      <div class="admin-products-layout hidden">
        <section class="kanm-card admin-card productos-card">
          <header class="kanm-card-header productos-card-header">
            <div class="kanm-card-header-row">
              <div class="kanm-card-header-title">
                <h3>Productos</h3>
                <p class="kanm-subtitle">Listado con precios, estado y stock.</p>
              </div>
              <button type="button" class="kanm-button ghost" id="productos-vista-completa">Vista completa</button>
            </div>
          </header>
          <div class="productos-controls">
            <div class="kanm-input-group">
              <input type="text" id="productos-buscar" class="admin-product-search" placeholder="Buscar producto..." />
            </div>
            <div class="kanm-input-group">
              <select id="productos-filtro-categoria" class="admin-product-filter">
                <option value="">Todas las categorías</option>
              </select>
            </div>
          </div>
          <div id="productos-lista" class="productos-lista admin-product-list"></div>
        </section>

        <section class="kanm-card admin-card producto-form-card">
          <header class="kanm-card-header">
            <h3>Formulario de producto</h3>
            <p class="kanm-subtitle">Crea nuevos productos o actualiza los existentes.</p>
          </header>
          <form id="prod-form" class="kanm-form" novalidate>
            <input type="hidden" id="prod-id" />

            <div class="product-form-sections">
              <section class="product-form-section">
                <div class="product-form-section-header">
                  <h4>Datos basicos</h4>
                  <p class="kanm-subtitle">Identifica el producto y su categoria.</p>
                </div>
                <div class="product-form-grid">
                  <div class="kanm-input-group">
                    <label for="prod-nombre">Nombre</label>
                    <input type="text" id="prod-nombre" placeholder="Ej. Cheesecake de fresa" />
                  </div>
                  <div class="kanm-input-group">
                    <label for="prod-categoria">Categor&iacute;a</label>
                    <select id="prod-categoria">
                      <option value="">Selecciona</option>
                    </select>
                  </div>
                  <div class="kanm-input-group producto-activo-group product-form-span">
                    <label for="prod-activo">Activo</label>
                    <input type="checkbox" id="prod-activo" checked />
                  </div>
                </div>
              </section>

              <section class="product-form-section">
                <div class="product-form-section-header">
                  <h4>Precios</h4>
                  <p class="kanm-subtitle">Define el precio principal y precios alternativos.</p>
                </div>
                <div class="product-form-grid">
                  <div class="kanm-input-group">
                    <label for="prod-precio">Precio</label>
                    <input type="text" id="prod-precio" inputmode="decimal" data-money placeholder="0.00" />
                  </div>
                  <div class="kanm-input-group producto-precios-group">
                    <label>Precios adicionales</label>
                    <div id="prod-precios-lista" class="producto-precios-lista"></div>
                    <button
                      type="button"
                      id="prod-precio-agregar"
                      class="kanm-button ghost kanm-button--sm"
                    >
                      Agregar precio
                    </button>
                    <span class="kanm-input-help">Agrega etiquetas opcionales para cada precio.</span>
                  </div>
                </div>
              </section>

              <section class="product-form-section">
                <div class="product-form-section-header">
                  <h4>Costos</h4>
                  <p class="kanm-subtitle">Controla el costo real y los costos de compra.</p>
                </div>
                <div class="product-form-grid">
                  <div class="kanm-input-group modo-reventa-only">
                    <label for="prod-costo-real">Costo unitario real</label>
                    <input type="text" id="prod-costo-real" inputmode="decimal" data-money placeholder="0.00" />
                    <span class="kanm-input-help">
                      Costo unitario real = lo que cuesta comprar 1 unidad del producto.
                    </span>
                  </div>
                  <div class="kanm-input-group modo-preparacion-only">
                    <label for="prod-costo-base">Costo base (sin ITBIS)</label>
                    <input type="text" id="prod-costo-base" inputmode="decimal" data-money placeholder="0.00" />
                  </div>
                  <div class="kanm-input-group modo-preparacion-only">
                    <label for="prod-costo-promedio">Costo promedio actual</label>
                    <input
                      type="text"
                      id="prod-costo-promedio"
                      inputmode="decimal"
                      data-money
                      placeholder="0.00"
                      readonly
                    />
                  </div>
                  <div class="kanm-input-group modo-preparacion-only">
                    <label for="prod-ultimo-costo">Ultimo costo (sin ITBIS)</label>
                    <input
                      type="text"
                      id="prod-ultimo-costo"
                      inputmode="decimal"
                      data-money
                      placeholder="0.00"
                      readonly
                    />
                  </div>
                  <div class="kanm-input-group modo-preparacion-only product-form-span">
                    <label class="kanm-input-toggle" for="prod-actualiza-costo">
                      <span>Actualizar costo con compras</span>
                      <input type="checkbox" id="prod-actualiza-costo" checked />
                    </label>
                    <p class="kanm-input-help">Si esta activo, las compras ajustan el costo promedio.</p>
                  </div>
                </div>
              </section>

              <section class="product-form-section">
                <div class="product-form-section-header">
                  <h4>Inventario y unidades</h4>
                  <p class="kanm-subtitle">Stock y medidas para controlar el inventario.</p>
                </div>
                <div class="product-form-grid">
                  <div class="kanm-input-group">
                    <label for="prod-stock">Stock</label>
                    <input type="number" id="prod-stock" min="0" placeholder="Cantidad en inventario" />
                  </div>
                  <div class="kanm-input-group">
                    <label class="kanm-input-toggle" for="prod-stock-indefinido">
                      <span>Stock indefinido</span>
                      <input type="checkbox" id="prod-stock-indefinido" />
                    </label>
                    <p class="kanm-input-help">Si esta activo, el sistema no controla cantidad.</p>
                  </div>
                  <div class="kanm-input-group modo-preparacion-only">
                    <label for="prod-unidad-base">Unidad base</label>
                    <select id="prod-unidad-base">
                      <option value="UND">Unidades</option>
                      <option value="ML">Mililitros (ML)</option>
                      <option value="LT">Litros (LT)</option>
                      <option value="GR">Gramos (GR)</option>
                      <option value="KG">Kilogramos (KG)</option>
                      <option value="OZ">Onzas (OZ)</option>
                      <option value="LB">Libras (LB)</option>
                    </select>
                  </div>
                  <div class="kanm-input-group modo-preparacion-only">
                    <label for="prod-contenido-unidad">Contenido por unidad</label>
                    <input
                      type="number"
                      id="prod-contenido-unidad"
                      step="0.0001"
                      min="0"
                      placeholder="1.0000"
                    />
                    <span class="kanm-input-help">Ej: 750 ML por botella.</span>
                  </div>
                  <div class="kanm-input-group modo-preparacion-only product-form-span">
                    <label class="kanm-input-toggle" for="prod-es-insumo">
                      <span>Es insumo</span>
                      <input type="checkbox" id="prod-es-insumo" />
                    </label>
                    <p class="kanm-input-help">Activalo si este producto se consume en recetas.</p>
                  </div>
                  <div class="kanm-input-group modo-preparacion-only insumo-vendible-group product-form-span">
                    <label class="kanm-input-toggle" for="prod-insumo-vendible">
                      <span>Insumo vendible</span>
                      <input type="checkbox" id="prod-insumo-vendible" />
                    </label>
                    <p class="kanm-input-help">Permite vender este insumo como producto final.</p>
                  </div>
                </div>
              </section>
            </div>

            <div class="producto-receta-section modo-preparacion-only" id="prod-receta-section">
              <div class="kanm-card-header">
                <h4>Receta del producto</h4>
                <p class="kanm-subtitle">Define insumos y cantidades en unidad base.</p>
              </div>
              <div class="receta-detalles" id="prod-receta-detalles"></div>
              <div class="receta-actions">
                <button type="button" class="kanm-button ghost kanm-button--sm" id="prod-receta-agregar">
                  Agregar insumo
                </button>
              </div>
              <div class="admin-form-actions">
                <button type="button" class="kanm-button secondary" id="prod-receta-guardar">
                  Guardar receta
                </button>
              </div>
              <div id="prod-receta-mensaje" class="kanm-message"></div>
            </div>

            <div class="admin-form-actions producto-form-actions">
              <button type="button" class="kanm-button secondary" id="prod-cancelar" hidden>
                Cancelar edicion
              </button>
              <button type="submit" class="kanm-button" id="prod-guardar">Guardar producto</button>
            </div>
            <div id="admin-mensaje" class="kanm-message"></div>
          </form>
        </section>
      </div>
    </section>

    <!-- Insumos -->
    <!-- Configuración -->
    <section class="admin-panel hidden" data-admin-section="configuracion" id="admin-section-config">
      <div class="kanm-card-header">
        <h2>Configuración</h2>
        <p class="kanm-subtitle">Impuesto ITBIS y datos de facturación.</p>
      </div>
      <div class="admin-grid-two admin-config-grid">
        <section class="kanm-card admin-card">
          <header class="kanm-card-header">
            <h3>Configuración de impuesto</h3>
            <p class="kanm-subtitle">Define el porcentaje de impuesto (ITBIS) aplicado.</p>
          </header>
          <form class="kanm-form" id="impuesto-form" novalidate>
            <div class="kanm-input-group">
              <label for="impuesto-valor">Impuesto (%)</label>
              <input type="number" id="impuesto-valor" min="0" step="0.01" placeholder="Ej. 18" />
            </div>
            <div class="admin-form-actions">
              <button type="button" class="kanm-button" id="impuesto-guardar">Guardar impuesto</button>
            </div>
            <div id="impuesto-mensaje" class="kanm-message"></div>
          </form>
        </section>

        <section class="kanm-card admin-card" id="itbis-acredita-config">
          <header class="kanm-card-header">
            <h3>ITBIS en compras</h3>
            <p class="kanm-subtitle">Define si este negocio acredita ITBIS al comprar.</p>
          </header>
          <form class="kanm-form" id="itbis-acredita-form" novalidate>
            <div class="kanm-input-group">
              <label class="kanm-input-toggle" for="itbis-acredita">
                <span>Este negocio acredita ITBIS</span>
                <input type="checkbox" id="itbis-acredita" checked />
              </label>
              <p class="kanm-input-help">
                Si no acredita ITBIS, el costo se capitaliza por defecto en el abastecimiento.
              </p>
            </div>
            <div class="admin-form-actions">
              <button type="button" class="kanm-button" id="itbis-acredita-guardar">Guardar configuracion</button>
            </div>
            <div id="itbis-acredita-mensaje" class="kanm-message"></div>
          </form>
        </section>

        <section class="kanm-card admin-card" id="inventario-config">
          <header class="kanm-card-header">
            <h3>Modo de inventario y costos</h3>
            <p class="kanm-subtitle">Define si el negocio opera por reventa o preparacion.</p>
          </header>
          <form class="kanm-form" id="inventario-config-form" novalidate>
            <div class="kanm-input-group">
              <label for="inventario-modo">Modo de inventario</label>
              <select id="inventario-modo">
                <option value="REVENTA">Reventa (costo unitario real)</option>
                <option value="PREPARACION">Preparacion (recetas e insumos)</option>
              </select>
              <span class="kanm-input-help">
                Reventa usa un costo simple por producto. Preparacion habilita recetas e insumos.
              </span>
            </div>
            <div class="kanm-input-group">
              <label class="kanm-input-toggle" for="insumos-bloqueo">
                <span>Bloquear venta si falta insumo</span>
                <input type="checkbox" id="insumos-bloqueo" />
              </label>
              <p class="kanm-input-help">Aplica solo cuando el modo es preparacion.</p>
            </div>
            <div class="admin-form-actions">
              <button type="button" class="kanm-button" id="inventario-guardar">
                Guardar configuracion
              </button>
            </div>
            <div id="inventario-mensaje" class="kanm-message"></div>
          </form>
        </section>

        <section class="kanm-card admin-card" id="factura-config">
          <header class="kanm-card-header">
            <h3>Configuración de facturación</h3>
            <p class="kanm-subtitle">Encabezado, contactos y rangos de comprobantes fiscales.</p>
          </header>

          <form class="kanm-form factura-form" id="factura-form" novalidate>
            <div class="admin-billing-grid">
              <div class="admin-field">
                <label for="factura-telefonos">Teléfonos</label>
                <div class="admin-phone-row">
                  <div id="factura-telefonos" class="factura-telefonos admin-phone-list"></div>
                  <button
                    type="button"
                    id="factura-telefono-agregar"
                    class="kanm-button ghost kanm-button--sm"
                  >
                    Agregar teléfono
                  </button>
                </div>
              </div>

              <div class="admin-field">
                <label for="factura-direccion">Dirección</label>
                <input type="text" id="factura-direccion" placeholder="Dirección del negocio" />
              </div>

              <div class="admin-field">
                <label for="factura-rnc">RNC del negocio</label>
                <input type="text" id="factura-rnc" placeholder="Ej. 1-01-99999-9" />
              </div>

              <div class="admin-field">
                <label for="factura-logo">Logo (URL)</label>
                <input type="text" id="factura-logo" placeholder="https://..." />
              </div>

              <div class="admin-field admin-field--full">
                <label for="factura-pie">Mensaje de pie</label>
                <textarea id="factura-pie" rows="2" placeholder="Gracias por su compra"></textarea>
              </div>
              </div>

              <div class="factura-rangos">
                <div class="kanm-card kanm-card--subsection">
                  <div class="kanm-card-header">
                    <h4>Secuencias fiscales activas</h4>
                    <p class="kanm-subtitle">Activa o desactiva las secuencias B01, B02 y B14.</p>
                  </div>
                  <div class="factura-rango-grid">
                    <label class="kanm-input-toggle" for="permitir-b01">
                      <span>Permitir secuencia B01</span>
                      <input type="checkbox" id="permitir-b01" checked />
                    </label>
                    <label class="kanm-input-toggle" for="permitir-b02">
                      <span>Permitir secuencia B02</span>
                      <input type="checkbox" id="permitir-b02" checked />
                    </label>
                    <label class="kanm-input-toggle" for="permitir-b14">
                      <span>Permitir secuencia B14</span>
                      <input type="checkbox" id="permitir-b14" checked />
                    </label>
                  </div>
                  <div class="admin-form-actions">
                    <button type="button" class="kanm-button" id="secuencias-guardar">Guardar secuencias</button>
                  </div>
                  <div id="secuencias-mensaje" class="kanm-message"></div>
                </div>

                <div class="kanm-card kanm-card--subsection">
                  <div class="kanm-card-header">
                    <h4>Secuencia B02 (Consumidor final)</h4>
                    <p class="kanm-subtitle">Define el rango disponible para comprobantes B02.</p>
                  </div>
                <div class="factura-rango-grid">
                  <div class="kanm-input-group">
                    <label for="ncf-b02-inicio">Inicio</label>
                    <input type="number" id="ncf-b02-inicio" min="1" />
                  </div>
                  <div class="kanm-input-group">
                    <label for="ncf-b02-fin">Fin</label>
                    <input type="number" id="ncf-b02-fin" min="1" />
                  </div>
                  <div class="kanm-input-group">
                    <label>Restantes</label>
                    <div class="factura-restante" id="ncf-b02-restante">—</div>
                  </div>
                </div>
                <div id="ncf-b02-alerta" class="kanm-message"></div>
              </div>

              <div class="kanm-card kanm-card--subsection">
                <div class="kanm-card-header">
                  <h4>Secuencia B01</h4>
                  <p class="kanm-subtitle">Configura el rango para comprobantes B01.</p>
                </div>
                <div class="factura-rango-grid">
                  <div class="kanm-input-group">
                    <label for="ncf-b01-inicio">Inicio</label>
                    <input type="number" id="ncf-b01-inicio" min="1" />
                  </div>
                  <div class="kanm-input-group">
                    <label for="ncf-b01-fin">Fin</label>
                    <input type="number" id="ncf-b01-fin" min="1" />
                  </div>
                  <div class="kanm-input-group">
                    <label>Restantes</label>
                    <div class="factura-restante" id="ncf-b01-restante">—</div>
                  </div>
                </div>
                <div id="ncf-b01-alerta" class="kanm-message"></div>
              </div>
            </div>

            <div class="admin-form-actions">
              <button type="button" class="kanm-button" id="factura-guardar">Guardar facturación</button>
            </div>
            <div id="factura-mensaje" class="kanm-message"></div>
          </form>
        </section>
      </div>
    </section>

    <!-- Usuarios -->
    <section class="admin-panel hidden" data-admin-section="usuarios" id="admin-section-usuarios">
      <div class="kanm-card-header">
        <h2>Usuarios</h2>
        <p class="kanm-subtitle">Administra las cuentas de meseras, cocina, caja y mostrador.</p>
      </div>
      <div class="admin-layout-two-cols">
        <section class="kanm-card admin-card">
          <header class="kanm-card-header">
            <h3>Usuarios registrados</h3>
            <p class="kanm-subtitle">Filtra por rol y gestiona estado.</p>
          </header>
          <div class="kanm-input-group">
            <label for="usuarios-rol">Rol</label>
            <select id="usuarios-rol">
              <option value="mesera">Mesera</option>
              <option value="cocina">Cocina</option>
              <option value="bar">Bar</option>
              <option value="caja">Caja</option>
              <option value="vendedor">Mostrador</option>
              <option value="admin">Administrador</option>
            </select>
          </div>
          <div id="usuarios-mensaje" class="kanm-message"></div>
          <div class="kanm-table-wrapper">
            <table class="kanm-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Usuario</th>
                  <th>Rol</th>
                  <th>Activo</th>
                  <th>En linea</th>
                  <th>Conectado</th>
                  <th>Desconectado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="usuarios-tabla-body"></tbody>
            </table>
          </div>
        </section>

        <section class="kanm-card admin-card">
          <header class="kanm-card-header">
            <h3>Crear o editar usuario</h3>
            <p class="kanm-subtitle">Actualiza datos y permisos.</p>
          </header>
          <form id="usuario-form" class="kanm-form" novalidate>
            <input type="hidden" id="usuario-id" />

            <div class="kanm-form-grid">
              <div class="kanm-input-group">
                <label for="usuario-nombre">Nombre</label>
                <input type="text" id="usuario-nombre" placeholder="Nombre visible" />
              </div>

              <div class="kanm-input-group">
                <label for="usuario-usuario">Usuario</label>
                <input type="text" id="usuario-usuario" placeholder="nombre.de.usuario" />
              </div>

              <div class="kanm-input-group">
                <label for="usuario-password">Contraseña</label>
                <div class="password-field">
                  <input type="password" id="usuario-password" placeholder="•••••••" />
                  <button
                    type="button"
                    class="password-toggle"
                    data-password-toggle
                    aria-pressed="false"
                    aria-label="Mostrar contrasena"
                  >
                    Mostrar
                  </button>
                </div>
                <p class="kanm-help-text">Obligatoria al crear. En edición es opcional.</p>
              </div>

              <div class="kanm-input-group">
                <label for="usuario-rol">Rol</label>
                <select id="usuario-rol">
                  <option value="mesera">Mesera</option>
                  <option value="cocina">Cocina</option>
                  <option value="bar">Bar</option>
                  <option value="caja">Caja</option>
                  <option value="vendedor">Mostrador</option>
                  <option value="supervisor">Supervisor</option>
                </select>
              </div>
            </div>

            <div class="kanm-input-group kanm-input-group--inline">
              <label for="usuario-activo">Activo</label>
              <input type="checkbox" id="usuario-activo" checked />
            </div>

            <div class="kanm-actions">
              <button type="submit" class="kanm-button">Guardar usuario</button>
              <button type="button" class="kanm-button ghost" id="usuario-limpiar">Limpiar</button>
            </div>
            <div id="usuario-form-mensaje" class="kanm-message"></div>
          </form>
        </section>
      </div>
    </section>

    <!-- Categorías -->
    <section class="admin-panel hidden" data-admin-section="categorias" id="admin-section-categorias">
      <div class="kanm-card-header">
        <h2>Categorías</h2>
        <p class="kanm-subtitle">Organiza las categorías que usarás en productos.</p>
      </div>
      <div class="admin-layout-two-cols categorias-layout">
        <section class="kanm-card admin-card">
          <header class="kanm-card-header">
            <h3>Listado de categorías</h3>
            <p class="kanm-subtitle">Busca por nombre.</p>
          </header>
          <div class="categorias-busqueda">
            <div class="kanm-input-group">
              <label for="categorias-buscar">Buscar</label>
              <input type="text" id="categorias-buscar" placeholder="Nombre de la categoría" />
            </div>
            <button type="button" class="kanm-button secondary" id="categorias-filtrar">Buscar</button>
          </div>
          <div id="categorias-lista-mensaje" class="kanm-message"></div>
          <div class="kanm-table-wrapper">
            <table class="kanm-table">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Área de preparación</th>
                  <th>Estado</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="categorias-tabla"></tbody>
            </table>
          </div>
        </section>

        <section class="kanm-card admin-card">
          <header class="kanm-card-header">
            <h3>Formulario de categoría</h3>
            <p class="kanm-subtitle">Crea o actualiza una categoría.</p>
          </header>
          <form id="categoria-form" class="kanm-form" novalidate>
            <input type="hidden" id="categoria-id" />
            <div class="kanm-form-grid categorias-grid">
              <div class="kanm-input-group">
                <label for="categoria-nombre">Nombre *</label>
                <input type="text" id="categoria-nombre" required placeholder="Ej. Postres, Bebidas" />
              </div>
              <div class="kanm-input-group">
                <label for="categoria-area">Área de preparación</label>
                <select id="categoria-area">
                  <option value="ninguna">Ninguna</option>
                  <option value="cocina">Cocina</option>
                  <option value="bar">Bar</option>
                </select>
              </div>
              <div class="kanm-input-group kanm-input-group--inline">
                <label for="categoria-activo">Activa</label>
                <input type="checkbox" id="categoria-activo" checked />
              </div>
            </div>

            <div class="admin-form-actions">
              <button type="button" class="kanm-button ghost" id="categoria-nuevo">Nuevo</button>
              <button type="submit" class="kanm-button" id="categoria-guardar">Guardar categoría</button>
            </div>
            <div id="categoria-mensaje" class="kanm-message"></div>
          </form>
        </section>
      </div>
    </section>

    <!-- Clientes -->
    <section class="admin-panel hidden" data-admin-section="clientes" id="admin-section-clientes">
      <div class="kanm-card-header">
        <h2>Clientes</h2>
        <p class="kanm-subtitle">Gestiona clientes y reutiliza sus datos en cotizaciones y caja.</p>
      </div>
      <div class="admin-layout-two-cols clientes-layout">
        <section class="kanm-card admin-card">
          <header class="kanm-card-header">
            <h3>Listado de clientes</h3>
            <p class="kanm-subtitle">Busca por nombre o documento.</p>
          </header>
          <div class="clientes-busqueda">
            <div class="kanm-input-group">
              <label for="clientes-buscar">Buscar</label>
              <input type="text" id="clientes-buscar" placeholder="Nombre o documento" />
            </div>
            <button type="button" class="kanm-button secondary" id="clientes-filtrar">Buscar</button>
          </div>
          <div id="clientes-lista-mensaje" class="kanm-message"></div>
          <div class="kanm-table-wrapper">
            <table class="kanm-table">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Documento</th>
                  <th>Teléfono</th>
                  <th>Email</th>
                  <th>Saldo pendiente</th>
                  <th>Estado</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="clientes-tabla"></tbody>
            </table>
          </div>
        </section>

        <div class="clientes-side">
          <section class="kanm-card admin-card">
            <header class="kanm-card-header">
              <h3>Formulario de cliente</h3>
              <p class="kanm-subtitle">Crea o edita información de contacto.</p>
            </header>
            <form id="cliente-form" class="kanm-form" novalidate>
              <input type="hidden" id="cliente-id" />
              <div class="kanm-form-grid clientes-grid">
                <div class="kanm-input-group">
                  <label for="cliente-nombre">Nombre del cliente *</label>
                  <input type="text" id="cliente-nombre" required placeholder="Ej. Juan Pérez" />
                </div>
                <div class="kanm-input-group">
                  <label for="cliente-documento">Documento</label>
                  <input type="text" id="cliente-documento" placeholder="RNC o cédula" />
                </div>
                <div class="kanm-input-group">
                  <label for="cliente-tipo-documento">Tipo de documento</label>
                  <select id="cliente-tipo-documento">
                    <option value="">Selecciona</option>
                    <option value="cedula">Cédula</option>
                    <option value="rnc">RNC</option>
                    <option value="pasaporte">Pasaporte</option>
                  </select>
                </div>
                <div class="kanm-input-group">
                  <label for="cliente-telefono">Teléfono</label>
                  <input type="text" id="cliente-telefono" placeholder="809..." />
                </div>
                <div class="kanm-input-group">
                  <label for="cliente-email">Email</label>
                  <input type="email" id="cliente-email" placeholder="correo@dominio.com" />
                </div>
              </div>

              <div class="kanm-form-grid clientes-grid">
                <div class="kanm-input-group">
                  <label for="cliente-direccion">Dirección</label>
                  <textarea id="cliente-direccion" rows="2" placeholder="Calle, número, sector"></textarea>
                </div>
                <div class="kanm-input-group">
                  <label for="cliente-notas">Notas internas</label>
                  <textarea id="cliente-notas" rows="2" placeholder="Recordatorios o preferencias"></textarea>
                </div>
              </div>

              <div class="kanm-input-group kanm-input-group--inline">
                <label for="cliente-activo">Activo</label>
                <input type="checkbox" id="cliente-activo" checked />
              </div>

              <div class="admin-form-actions">
                <button type="button" class="kanm-button ghost" id="cliente-nuevo">Nuevo</button>
                <button type="submit" class="kanm-button" id="cliente-guardar">Guardar cliente</button>
              </div>
              <div id="cliente-mensaje" class="kanm-message"></div>
            </form>
          </section>

          <section class="kanm-card admin-card" id="clientes-deudas-card">
            <header class="kanm-card-header">
              <h3>Cuentas por cobrar</h3>
              <p class="kanm-subtitle">Registra deudas y abonos del cliente seleccionado.</p>
            </header>

            <div class="admin-resumen-grid deudas-resumen-grid">
              <div class="resumen-metric">
                <span class="resumen-label">Total adeudado</span>
                <span class="resumen-value" id="clientes-deudas-total">DOP&nbsp;0.00</span>
              </div>
              <div class="resumen-metric">
                <span class="resumen-label">Total abonado</span>
                <span class="resumen-value" id="clientes-deudas-pagado">DOP&nbsp;0.00</span>
              </div>
              <div class="resumen-metric">
                <span class="resumen-label">Saldo pendiente</span>
                <span class="resumen-value" id="clientes-deudas-saldo">DOP&nbsp;0.00</span>
              </div>
            </div>

            <div id="cliente-deudas-mensaje" class="kanm-message"></div>
            <div class="kanm-table-wrapper">
              <table class="kanm-table">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Detalle</th>
                    <th>Monto</th>
                    <th>Abonado</th>
                    <th>Saldo</th>
                    <th>Estado</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="cliente-deudas-tabla"></tbody>
              </table>
            </div>

            <form id="cliente-deuda-form" class="kanm-form" novalidate>
              <input type="hidden" id="deuda-id" />
              <div class="kanm-form-grid deudas-grid">
                <div class="kanm-input-group deuda-productos-group">
                  <label for="deuda-producto-select">¿Qué debe?</label>
                  <div class="deuda-productos-controls">
                    <select id="deuda-producto-select">
                      <option value="">Selecciona producto</option>
                    </select>
                    <input
                      type="number"
                      id="deuda-producto-cantidad"
                      min="0.01"
                      step="0.01"
                      inputmode="decimal"
                      value="1"
                    />
                    <button type="button" class="kanm-button secondary" id="deuda-producto-agregar">
                      Agregar
                    </button>
                  </div>
                  <div class="kanm-table-wrapper deuda-productos-table">
                    <table class="kanm-table">
                      <thead>
                        <tr>
                          <th>Producto</th>
                          <th class="text-right">Cantidad</th>
                          <th class="text-right">Precio</th>
                          <th class="text-right">Total</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody id="deuda-productos-tabla"></tbody>
                    </table>
                  </div>
                  <span class="kanm-input-help">
                    El monto se calcula automáticamente con los productos agregados.
                  </span>
                </div>
                <div class="kanm-input-group">
                  <label for="deuda-fecha">Fecha</label>
                  <input type="date" id="deuda-fecha" />
                </div>
                <div class="kanm-input-group">
                  <label for="deuda-descripcion">Referencia</label>
                  <input type="text" id="deuda-descripcion" placeholder="Ej. Crédito fiado" />
                </div>
                <div class="kanm-input-group">
                  <label for="deuda-monto">Monto adeudado *</label>
                  <input
                    type="text"
                    id="deuda-monto"
                    inputmode="decimal"
                    data-money
                    placeholder="0.00"
                    readonly
                    required
                  />
                </div>
                <div class="kanm-input-group">
                  <label for="deuda-notas">Notas</label>
                  <textarea id="deuda-notas" rows="2" placeholder="Detalles adicionales"></textarea>
                </div>
              </div>
              <div class="admin-form-actions">
                <button type="button" class="kanm-button ghost" id="deuda-nueva">Nueva deuda</button>
                <button type="submit" class="kanm-button" id="deuda-guardar">Guardar deuda</button>
              </div>
              <div id="deuda-mensaje" class="kanm-message"></div>
            </form>

            <div class="deudas-abonos-panel">
              <div class="deudas-abonos-header">
                <div>
                  <h4>Abonos</h4>
                  <p class="kanm-subtitle" id="deuda-seleccionada">
                    Selecciona una deuda para registrar abonos.
                  </p>
                </div>
              </div>

              <form id="deuda-abono-form" class="kanm-form" novalidate>
                <div class="kanm-form-grid deudas-grid">
                  <div class="kanm-input-group">
                    <label for="abono-fecha">Fecha</label>
                    <input type="date" id="abono-fecha" />
                  </div>
                  <div class="kanm-input-group">
                    <label for="abono-monto">Monto abonado *</label>
                    <input type="text" id="abono-monto" inputmode="decimal" data-money placeholder="0.00" required />
                  </div>
                  <div class="kanm-input-group">
                    <label for="abono-metodo">Método de pago</label>
                    <select id="abono-metodo">
                      <option value="">Selecciona</option>
                      <option value="efectivo">Efectivo</option>
                      <option value="transferencia">Transferencia</option>
                      <option value="tarjeta">Tarjeta</option>
                      <option value="otro">Otro</option>
                    </select>
                  </div>
                  <div class="kanm-input-group">
                    <label for="abono-notas">Notas</label>
                    <textarea id="abono-notas" rows="2" placeholder="Referencia o comentario"></textarea>
                  </div>
                </div>
                <div class="admin-form-actions">
                  <button type="submit" class="kanm-button" id="abono-guardar">Registrar abono</button>
                </div>
                <div id="deuda-abono-mensaje" class="kanm-message"></div>
              </form>

              <div class="kanm-table-wrapper">
                <table class="kanm-table">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Monto</th>
                      <th>Método</th>
                      <th>Notas</th>
                    </tr>
                  </thead>
                  <tbody id="deuda-abonos-tabla"></tbody>
                </table>
              </div>
            </div>
          </section>
        </div>
      </div>
    </section>

    <!-- Cotizaciones -->
    <section class="admin-panel hidden" data-admin-section="cotizaciones" id="admin-section-cotizaciones">
      <div class="kanm-card-header">
        <h2>Cotizaciones</h2>
        <p class="kanm-subtitle">Gestiona propuestas, descuentos y facturación.</p>
      </div>
      <div class="cotizaciones-layout">
        <section class="kanm-card admin-card cotizaciones-card cotizaciones-card--lista">
          <header class="kanm-card-header">
            <div>
              <h3>Listado de cotizaciones</h3>
              <p class="kanm-subtitle">Filtra por fecha, estado o cliente.</p>
            </div>
          </header>

          <form class="cotizaciones-filtros" novalidate>
            <div class="kanm-input-group">
              <label for="cotizaciones-desde">Fecha desde</label>
              <input type="date" id="cotizaciones-desde" />
            </div>
            <div class="kanm-input-group">
              <label for="cotizaciones-hasta">Fecha hasta</label>
              <input type="date" id="cotizaciones-hasta" />
            </div>
            <div class="kanm-input-group">
              <label for="cotizaciones-estado">Estado</label>
              <select id="cotizaciones-estado">
                <option value="">Todos</option>
                <option value="borrador">Borrador</option>
                <option value="enviada">Enviada</option>
                <option value="aceptada">Aceptada</option>
                <option value="rechazada">Rechazada</option>
                <option value="vencida">Vencida</option>
                <option value="facturada">Facturada</option>
              </select>
            </div>
            <div class="kanm-input-group">
              <label for="cotizaciones-buscar">Búsqueda</label>
              <input type="text" id="cotizaciones-buscar" placeholder="Cliente o código" />
            </div>
            <div class="cotizaciones-filtros-actions">
              <button type="button" class="kanm-button secondary" id="cotizaciones-filtrar">Filtrar</button>
              <button type="button" class="kanm-button" id="cotizaciones-nueva">Nueva cotización</button>
            </div>
          </form>

          <div id="cotizaciones-lista-mensaje" class="kanm-message"></div>
          <div id="cotizaciones-lista" class="cotizacion-list"></div>
        </section>

        <section class="kanm-card admin-card cotizaciones-card cotizaciones-card--editor">
          <header class="kanm-card-header">
            <h3>Editor de cotización</h3>
            <p class="kanm-subtitle">Completa los datos y guarda como borrador o envía al cliente.</p>
          </header>
          <form id="cotizacion-form" class="kanm-form" novalidate>
            <input type="hidden" id="cotizacion-id" />
            <div class="cotizacion-meta-grid">
              <div class="cotizacion-meta-block">
                <p class="kanm-subtitle">Código</p>
                <div class="cotizacion-codigo" id="cotizacion-codigo">Nueva</div>
              </div>
              <div class="cotizacion-meta-block">
                <p class="kanm-subtitle">Estado</p>
                <span id="cotizacion-estado" class="cotizacion-estado-badge" data-estado="borrador">Borrador</span>
              </div>
              <div class="cotizacion-meta-block">
                <p class="kanm-subtitle">Creada</p>
                <div id="cotizacion-fecha" class="cotizacion-meta-value">--</div>
              </div>
              <div class="kanm-input-group">
                <label for="cotizacion-validez">Válida hasta</label>
                <input type="date" id="cotizacion-validez" />
              </div>
            </div>

            <div class="cotizacion-section">
              <div class="cotizacion-section-header">
                <h4>Datos del cliente</h4>
                <p class="kanm-subtitle">Identifica a quién se envía la propuesta.</p>
              </div>
              <div class="cotizacion-grid">
                <div class="kanm-input-group">
                  <label for="cotizacion-cliente-buscar">Buscar cliente</label>
                  <input type="text" id="cotizacion-cliente-buscar" list="cotizacion-clientes" placeholder="Nombre o documento" />
                  <datalist id="cotizacion-clientes"></datalist>
                </div>
                <div class="kanm-input-group">
                  <label for="cotizacion-cliente-nombre">Nombre del cliente</label>
                  <input type="text" id="cotizacion-cliente-nombre" placeholder="Consumidor final" />
                </div>
                <div class="kanm-input-group">
                  <label for="cotizacion-cliente-documento">Documento</label>
                  <input type="text" id="cotizacion-cliente-documento" placeholder="RNC o cédula" />
                </div>
                <div class="kanm-input-group">
                  <label for="cotizacion-cliente-contacto">Contacto</label>
                  <input type="text" id="cotizacion-cliente-contacto" placeholder="Teléfono o correo" />
                </div>
              </div>
            </div>

            <div class="cotizacion-section">
              <div class="cotizacion-section-header">
                <h4>Notas</h4>
                <p class="kanm-subtitle">Información visible y recordatorios internos.</p>
              </div>
              <div class="cotizacion-grid">
                <div class="kanm-input-group">
                  <label for="cotizacion-notas-cliente">Notas para el cliente</label>
                  <textarea id="cotizacion-notas-cliente" rows="3" placeholder="Condiciones, entregas, etc."></textarea>
                </div>
                <div class="kanm-input-group">
                  <label for="cotizacion-notas-internas">Notas internas</label>
                  <textarea id="cotizacion-notas-internas" rows="3" placeholder="Recordatorios para el equipo"></textarea>
                </div>
              </div>
            </div>

            <div class="cotizacion-section">
              <div class="cotizacion-section-header">
                <h4>Ítems de cotización</h4>
                <p class="kanm-subtitle">Agrega productos y ajustes por línea.</p>
              </div>
              <div class="cotizacion-items-wrapper kanm-table-wrapper">
                <table class="kanm-table cotizacion-items-table">
                  <thead>
                    <tr>
                      <th>Producto</th>
                      <th>Descripción</th>
                      <th>Cantidad</th>
                      <th>Precio</th>
                      <th>Desc %</th>
                      <th>Desc $</th>
                      <th>Total línea</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="cotizacion-items-body"></tbody>
                </table>
              </div>

              <div class="cotizacion-items-actions">
                <button type="button" class="kanm-button secondary" id="cotizacion-item-agregar">Agregar ítem</button>
              </div>
            </div>

            <div class="cotizacion-section cotizacion-totales">
              <div class="cotizacion-totales-grid">
                <div class="kanm-input-group">
                  <label for="cotizacion-descuento-porcentaje">Descuento global (%)</label>
                  <input type="number" id="cotizacion-descuento-porcentaje" min="0" step="0.01" />
                </div>
                <div class="kanm-input-group">
                  <label for="cotizacion-descuento-monto">Descuento global (monto)</label>
                  <input type="text" id="cotizacion-descuento-monto" inputmode="decimal" data-money />
                </div>
              </div>
              <div class="cotizacion-totales-display">
                <div class="cotizacion-total-row"><span>Subtotal</span><span id="cotizacion-subtotal">DOP&nbsp;0.00</span></div>
                <div class="cotizacion-total-row"><span>Descuento</span><span id="cotizacion-descuento-total">DOP&nbsp;0.00</span></div>
                <div class="cotizacion-total-row"><span>Impuesto</span><span id="cotizacion-impuesto">DOP&nbsp;0.00</span></div>
                <div class="cotizacion-total-row cotizacion-total-final"><span>Total</span><span id="cotizacion-total">DOP&nbsp;0.00</span></div>
              </div>
            </div>

            <div class="admin-form-actions cotizacion-actions">
              <button type="button" class="kanm-button secondary" id="cotizacion-guardar">Guardar borrador</button>
              <button type="button" class="kanm-button ghost" id="cotizacion-enviar">Marcar enviada</button>
              <button type="button" class="kanm-button" id="cotizacion-aceptar">Aceptar</button>
              <button type="button" class="kanm-button ghost" id="cotizacion-imprimir">Imprimir</button>
              <button type="button" class="kanm-button" id="cotizacion-facturar">Facturar cotización</button>
            </div>
            <div id="cotizacion-mensaje" class="kanm-message"></div>
          </form>
        </section>
      </div>
    </section>

    <!-- Compras & 606 -->
    <section class="admin-panel hidden" data-admin-section="compras" id="admin-section-compras">
      <div class="kanm-card-header">
        <h2>Compras &amp; 606</h2>
        <p class="kanm-subtitle">Registra compras manuales y genera el 606.</p>
      </div>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>Registro de compras (606)</h3>
          <p class="kanm-subtitle">Captura facturas de proveedores y recalcula montos.</p>
        </header>

        <form id="compra-form" class="kanm-form" novalidate>
          <div class="kanm-form-grid compra-grid">
            <div class="kanm-input-group">
              <label for="compra-proveedor">Proveedor</label>
              <input type="text" id="compra-proveedor" placeholder="Nombre del proveedor" />
            </div>
            <div class="kanm-input-group">
              <label for="compra-rnc">RNC</label>
              <input type="text" id="compra-rnc" placeholder="RNC" />
            </div>
            <div class="kanm-input-group">
              <label for="compra-fecha">Fecha</label>
              <input type="date" id="compra-fecha" />
            </div>
            <div class="kanm-input-group">
              <label for="compra-tipo">Tipo de comprobante</label>
              <select id="compra-tipo">
                <option value="B01">B01</option>
                <option value="B02">B02</option>
                <option value="B15">B15</option>
                <option value="B16">B16</option>
              </select>
            </div>
          </div>

          <div class="kanm-form-grid compra-grid">
            <div class="kanm-input-group">
              <label for="compra-ncf">NCF</label>
              <input type="text" id="compra-ncf" placeholder="B01XXXXXXXX" />
            </div>
            <div class="kanm-input-group">
              <label for="compra-gravado">Monto gravado</label>
              <input type="text" id="compra-gravado" inputmode="decimal" data-money placeholder="0.00" />
            </div>
            <div class="kanm-input-group">
              <label for="compra-impuesto">ITBIS</label>
              <input type="text" id="compra-impuesto" inputmode="decimal" data-money placeholder="0.00" />
            </div>
            <div class="kanm-input-group">
              <label for="compra-exento">Monto exento</label>
              <input type="text" id="compra-exento" inputmode="decimal" data-money placeholder="0.00" />
            </div>
            <div class="kanm-input-group">
              <label for="compra-total">Total factura</label>
              <input type="text" id="compra-total" inputmode="decimal" data-money placeholder="0.00" />
            </div>
          </div>

          <div class="kanm-input-group">
            <label for="compra-comentarios">Comentarios</label>
            <textarea id="compra-comentarios" rows="2" placeholder="Notas u observaciones"></textarea>
          </div>

          <div class="compra-detalle-header">
            <h4 class="kanm-subheading">Detalle de compra</h4>
            <div class="compra-detalle-actions">
              <button type="button" class="kanm-button secondary" id="compra-agregar-detalle">
                Agregar linea
              </button>
              <button type="button" class="kanm-button ghost" id="compra-recalcular">Recalcular</button>
            </div>
          </div>
          <div class="compra-detalles" id="compra-detalles"></div>

          <div class="admin-form-actions">
            <button type="submit" class="kanm-button">Guardar compra</button>
          </div>

          <div id="compra-mensaje" class="kanm-message"></div>
        </form>
      </section>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>Historial de compras</h3>
          <p class="kanm-subtitle">Revisa las compras registradas y sus totales.</p>
        </header>
        <div id="compras-mensaje" class="kanm-message"></div>
        <div class="kanm-table-wrapper">
          <table class="kanm-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Proveedor</th>
                <th>NCF</th>
                <th>Total</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="compras-tabla"></tbody>
          </table>
        </div>
      </section>

      <section class="kanm-card admin-card" id="admin-reporte-606">
        <header class="kanm-card-header">
          <h3>Reporte 606 - Compras</h3>
          <p class="kanm-subtitle">Genera el resumen mensual de compras y gastos deducibles.</p>
        </header>
        <div class="admin-report-controls">
          <div class="kanm-input-group">
            <label for="reporte-606-mes">Mes de consulta</label>
            <input type="month" id="reporte-606-mes" />
          </div>
          <div class="admin-report-actions">
            <button type="button" class="kanm-button secondary" id="reporte-606-consultar">
              Consultar
            </button>
            <button type="button" class="kanm-button" id="reporte-606-exportar">
              Exportar 606 (CSV)
            </button>
          </div>
        </div>
        <div class="admin-resumen-grid">
          <div class="resumen-metric">
            <span class="resumen-label">Facturas</span>
            <span class="resumen-value" id="reporte-606-total">0</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Total mes</span>
            <span class="resumen-value" id="reporte-606-monto">DOP&nbsp;0.00</span>
          </div>
        </div>
        <div id="reporte-606-mensaje" class="kanm-message"></div>
        <div class="kanm-table-wrapper">
          <table class="kanm-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Proveedor</th>
                <th>RNC</th>
                <th>Tipo</th>
                <th>NCF</th>
                <th>Gravado</th>
                <th>ITBIS</th>
                <th>Exento</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="reporte-606-tabla"></tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- Abastecimiento -->
    <section class="admin-panel hidden" data-admin-section="abastecimiento" id="admin-section-abastecimiento">
      <div class="kanm-card-header">
        <h2>Abastecimiento</h2>
        <p class="kanm-subtitle">
          Registra compras de mercancia para reventa, actualiza el inventario y define el origen de fondos.
        </p>
      </div>

      <div class="admin-seccion-grid">
        <section class="kanm-card admin-card admin-seccion-panel">
          <header class="kanm-card-header">
            <h3>Registro de mercancia</h3>
            <p class="kanm-subtitle">Agrega productos y ajusta el stock automaticamente.</p>
          </header>

          <form id="abastecimiento-form" class="kanm-form" novalidate>
            <div class="kanm-form-grid">
              <div class="kanm-input-group">
                <label for="abastecimiento-proveedor">Proveedor</label>
                <input type="text" id="abastecimiento-proveedor" placeholder="Nombre del proveedor" />
              </div>
              <div class="kanm-input-group">
                <label for="abastecimiento-fecha">Fecha</label>
                <input type="date" id="abastecimiento-fecha" />
              </div>
              <div class="kanm-input-group">
                <label for="abastecimiento-origen">Origen de fondos</label>
                <select id="abastecimiento-origen">
                  <option value="negocio">Negocio</option>
                  <option value="caja">Caja</option>
                  <option value="aporte_externo">Empresa</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="abastecimiento-metodo">Metodo de pago</label>
                <select id="abastecimiento-metodo">
                  <option value="">Selecciona</option>
                  <option value="efectivo">Efectivo</option>
                  <option value="transferencia">Transferencia</option>
                  <option value="tarjeta">Tarjeta</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
            </div>

            <div class="kanm-input-group">
              <label for="abastecimiento-observaciones">Observaciones</label>
              <textarea
                id="abastecimiento-observaciones"
                rows="2"
                placeholder="Notas o condiciones de la compra"
              ></textarea>
              <span class="kanm-input-help">
                Si eliges Caja, se registrara automaticamente una salida de caja.
              </span>
            </div>
            <div class="kanm-input-group kanm-input-group--inline kanm-input-toggle">
              <label class="kanm-checkbox" for="abastecimiento-aplica-itbis">
                <input type="checkbox" id="abastecimiento-aplica-itbis" checked />
                <span>Aplicar ITBIS (18%)</span>
              </label>
              <span class="kanm-input-help">Aplica el ITBIS al total de la compra.</span>
            </div>
            <div class="kanm-input-group kanm-input-group--inline kanm-input-toggle">
              <label class="kanm-checkbox" for="abastecimiento-itbis-capitalizable">
                <input type="checkbox" id="abastecimiento-itbis-capitalizable" />
                <span>ITBIS capitalizable en el costo</span>
              </label>
              <span class="kanm-input-help">Usa el ITBIS como parte del costo unitario.</span>
            </div>

            <div class="compra-detalle-header">
              <h4 class="kanm-subheading">Detalle de productos</h4>
              <div class="compra-detalle-actions">
                <button type="button" class="kanm-button secondary" id="abastecimiento-agregar-detalle">
                  Agregar linea
                </button>
              </div>
            </div>

            <div class="compra-detalles abastecimiento-detalles" id="abastecimiento-detalles"></div>

            <div class="abastecimiento-resumen">
              <div class="abastecimiento-resumen-linea">
                <span>Subtotal</span>
                <strong id="abastecimiento-subtotal">DOP&nbsp;0.00</strong>
              </div>
              <div class="abastecimiento-resumen-linea" id="abastecimiento-itbis-row">
                <span>ITBIS (18%)</span>
                <strong id="abastecimiento-itbis">DOP&nbsp;0.00</strong>
              </div>
              <div class="abastecimiento-resumen-linea total">
                <span id="abastecimiento-total-label">Total con ITBIS</span>
                <strong id="abastecimiento-total">DOP&nbsp;0.00</strong>
              </div>
            </div>

            <div class="admin-form-actions">
              <button type="button" class="kanm-button secondary" id="abastecimiento-cancelar" hidden>
                Cancelar edicion
              </button>
              <button type="submit" class="kanm-button" id="abastecimiento-submit">Registrar compra</button>
            </div>

            <div id="abastecimiento-mensaje" class="kanm-message"></div>
          </form>
        </section>

        <section class="kanm-card admin-card admin-seccion-panel">
          <header class="kanm-card-header">
            <h3>Historial de abastecimiento</h3>
            <p class="kanm-subtitle">Seguimiento de compras, origen y totales.</p>
          </header>

          <div id="abastecimiento-lista-mensaje" class="kanm-message"></div>
          <div class="kanm-table-wrapper">
            <table class="kanm-table">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Proveedor</th>
                  <th>Origen</th>
                  <th>Items</th>
                  <th>Subtotal</th>
                  <th>Total</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="abastecimiento-tabla"></tbody>
            </table>
          </div>

          <div class="kanm-table-wrapper abastecimiento-detalle-wrapper" id="abastecimiento-detalle-wrapper" hidden>
            <div class="abastecimiento-detalle-header">
              <h4 class="kanm-subheading" id="abastecimiento-detalle-titulo">Detalle compra</h4>
              <p class="kanm-subtitle" id="abastecimiento-detalle-subtitulo"></p>
            </div>
            <table class="kanm-table">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th class="text-right">Cantidad</th>
                  <th class="text-right">Costo</th>
                  <th class="text-right">Total</th>
                </tr>
              </thead>
              <tbody id="abastecimiento-detalle-tabla"></tbody>
            </table>
          </div>
        </section>
      </div>
    </section>

    <!-- Gastos -->
    <section class="admin-panel hidden" data-admin-section="gastos" id="admin-section-gastos">
      <div class="kanm-card-header">
        <h2>Gastos</h2>
        <p class="kanm-subtitle">Registra y analiza los gastos operativos del negocio.</p>
      </div>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>Resumen del periodo</h3>
          <p class="kanm-subtitle">Totales y categorias principales.</p>
        </header>
        <div class="admin-resumen-grid gastos-resumen-grid">
          <div class="resumen-metric">
            <span class="resumen-label">Total gastos</span>
            <span class="resumen-value" id="gastos-resumen-total">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Promedio diario</span>
            <span class="resumen-value" id="gastos-resumen-promedio">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Top categorias</span>
            <div class="gastos-top-categorias" id="gastos-resumen-top"></div>
          </div>
        </div>
      </section>

      <div class="admin-grid-two">
        <section class="kanm-card admin-card">
          <header class="kanm-card-header">
            <h3>Registrar gasto</h3>
            <p class="kanm-subtitle">Completa el formulario y guarda el gasto.</p>
          </header>
          <form id="gasto-form" class="kanm-form" novalidate>
            <input type="hidden" id="gasto-id" />
            <div class="kanm-form-grid">
              <div class="kanm-input-group">
                <label for="gasto-fecha">Fecha</label>
                <input type="date" id="gasto-fecha" />
              </div>
              <div class="kanm-input-group">
                <label for="gasto-monto">Monto</label>
                <input type="text" id="gasto-monto" inputmode="decimal" data-money placeholder="0.00" />
              </div>
              <div class="kanm-input-group">
                <label for="gasto-moneda">Moneda</label>
                <select id="gasto-moneda">
                  <option value="DOP">DOP</option>
                  <option value="USD">USD</option>
                  <option value="EUR">EUR</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="gasto-categoria">Categoria</label>
                <input type="text" id="gasto-categoria" list="gastos-categorias" placeholder="Ej. Alquiler" />
              </div>
              <div class="kanm-input-group">
                <label for="gasto-tipo">Tipo de gasto</label>
                <select id="gasto-tipo">
                  <option value="OPERATIVO">Operativo</option>
                  <option value="INVENTARIO">Inventario</option>
                  <option value="RETIRO_CAJA">Retiro de caja</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="gasto-metodo">Metodo de pago</label>
                <select id="gasto-metodo">
                  <option value="">Selecciona</option>
                  <option value="efectivo">Efectivo</option>
                  <option value="transferencia">Transferencia</option>
                  <option value="tarjeta">Tarjeta</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="gasto-proveedor">Proveedor</label>
                <input type="text" id="gasto-proveedor" placeholder="Proveedor o tercero" />
              </div>
              <div class="kanm-input-group">
                <label for="gasto-ncf">Comprobante NCF</label>
                <input type="text" id="gasto-ncf" placeholder="B01XXXXXXXX" />
              </div>
              <div class="kanm-input-group">
                <label for="gasto-referencia">Referencia</label>
                <input type="text" id="gasto-referencia" placeholder="#transferencia o factura" />
              </div>
            </div>

            <div class="kanm-input-group">
              <label for="gasto-descripcion">Descripcion</label>
              <textarea id="gasto-descripcion" rows="2" placeholder="Notas o detalle del gasto"></textarea>
            </div>

            <div class="kanm-form-grid">
              <div class="kanm-input-group">
                <label class="kanm-input-toggle" for="gasto-recurrente">
                  <span>Gasto recurrente</span>
                  <input type="checkbox" id="gasto-recurrente" />
                </label>
              </div>
              <div class="kanm-input-group">
                <label for="gasto-frecuencia">Frecuencia</label>
                <select id="gasto-frecuencia">
                  <option value="">Selecciona</option>
                  <option value="mensual">Mensual</option>
                  <option value="semanal">Semanal</option>
                  <option value="quincenal">Quincenal</option>
                  <option value="anual">Anual</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="gasto-tags">Tags</label>
                <input type="text" id="gasto-tags" placeholder="marketing, delivery, fijo" />
              </div>
            </div>

            <div class="admin-form-actions">
              <button type="submit" class="kanm-button">Guardar gasto</button>
              <button type="button" class="kanm-button ghost" id="gasto-cancelar">Cancelar</button>
            </div>
            <div id="gasto-mensaje" class="kanm-message"></div>
          </form>
        </section>

        <section class="kanm-card admin-card">
          <header class="kanm-card-header">
            <h3>Listado de gastos</h3>
            <p class="kanm-subtitle">Filtra por fecha, categoria o texto.</p>
          </header>
          <div class="admin-report-controls gastos-filtros">
            <div class="kanm-input-group">
              <label for="gastos-desde">Desde</label>
              <input type="date" id="gastos-desde" />
            </div>
            <div class="kanm-input-group">
              <label for="gastos-hasta">Hasta</label>
              <input type="date" id="gastos-hasta" />
            </div>
            <div class="kanm-input-group">
              <label for="gastos-categoria-filtro">Categoria</label>
              <input type="text" id="gastos-categoria-filtro" list="gastos-categorias" placeholder="Todas" />
            </div>
            <div class="kanm-input-group">
              <label for="gastos-tipo-filtro">Tipo</label>
              <select id="gastos-tipo-filtro">
                <option value="">Todos</option>
                <option value="OPERATIVO">Operativo</option>
                <option value="INVENTARIO">Inventario</option>
                <option value="RETIRO_CAJA">Retiros</option>
              </select>
            </div>
            <div class="kanm-input-group">
              <label for="gastos-metodo-filtro">Metodo pago</label>
              <select id="gastos-metodo-filtro">
                <option value="">Todos</option>
                <option value="efectivo">Efectivo</option>
                <option value="transferencia">Transferencia</option>
                <option value="tarjeta">Tarjeta</option>
                <option value="otro">Otro</option>
              </select>
            </div>
            <div class="kanm-input-group">
              <label for="gastos-buscar">Buscar</label>
              <input type="text" id="gastos-buscar" placeholder="Proveedor, descripcion o NCF" />
            </div>
            <div class="admin-report-actions">
              <button type="button" class="kanm-button secondary" id="gastos-consultar">Buscar</button>
              <button type="button" class="kanm-button ghost" id="gastos-limpiar">Limpiar</button>
            </div>
          </div>
          <div id="gastos-mensaje-lista" class="kanm-message"></div>
          <div class="kanm-table-wrapper">
            <table class="kanm-table">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Categoria</th>
                  <th>Tipo</th>
                  <th>Metodo</th>
                  <th>Proveedor</th>
                  <th>Monto</th>
                  <th>NCF</th>
                  <th>Recurrente</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="gastos-tabla"></tbody>
            </table>
          </div>
        </section>
      </div>
      <datalist id="gastos-categorias"></datalist>
    </section>

    <!-- Ventas & 607 -->
    <section class="admin-panel hidden" data-admin-section="ventas" id="admin-section-ventas">
      <div class="kanm-card-header">
        <h2>Ventas &amp; 607</h2>
        <p class="kanm-subtitle">Consulta y exporta el 607 de ventas.</p>
      </div>

      <section class="kanm-card admin-card" id="admin-reporte-607">
        <header class="kanm-card-header">
          <h3>Reporte 607 - Ventas</h3>
          <p class="kanm-subtitle">Resumen fiscal mensual de ventas.</p>
        </header>
        <div class="admin-report-controls">
          <div class="kanm-input-group">
            <label for="reporte-607-mes">Mes de consulta</label>
            <input type="month" id="reporte-607-mes" />
          </div>
          <div class="admin-report-actions">
            <button type="button" class="kanm-button secondary" id="reporte-607-consultar">
              Consultar
            </button>
            <button type="button" class="kanm-button" id="reporte-607-exportar">
              Exportar 607 (CSV)
            </button>
          </div>
        </div>
        <div class="admin-resumen-grid">
          <div class="resumen-metric">
            <span class="resumen-label">Facturas</span>
            <span class="resumen-value" id="reporte-607-total">0</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Total mes</span>
            <span class="resumen-value" id="reporte-607-monto">DOP&nbsp;0.00</span>
          </div>
        </div>
        <div id="reporte-607-mensaje" class="kanm-message"></div>
        <div class="kanm-table-wrapper">
          <table class="kanm-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>NCF</th>
                <th>Cliente</th>
                <th>Documento</th>
                <th>Tipo</th>
                <th>Gravado</th>
                <th>ITBIS</th>
                <th>Descuento</th>
                <th>Propina</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="reporte-607-tabla"></tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- Analisis -->
    <section class="admin-panel hidden" data-admin-section="analisis" id="admin-section-analisis">
      <div class="kanm-card-header">
        <h2>Analisis del negocio</h2>
        <p class="kanm-subtitle">KPIs, tendencias y recomendaciones basadas en ventas y gastos.</p>
      </div>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>Periodo de analisis</h3>
          <p class="kanm-subtitle">Selecciona un rango o un periodo rapido.</p>
        </header>
        <div class="analisis-periodo-actions">
          <button type="button" class="kanm-button ghost" data-analisis-range="hoy">Hoy</button>
          <button type="button" class="kanm-button ghost" data-analisis-range="7d">7 dias</button>
          <button type="button" class="kanm-button ghost" data-analisis-range="30d">30 dias</button>
          <button type="button" class="kanm-button ghost" data-analisis-range="mes">Mes actual</button>
          <button type="button" class="kanm-button ghost" data-analisis-range="mes-anterior">Mes anterior</button>
        </div>
        <div class="analisis-periodo-grid">
          <div class="kanm-input-group">
            <label for="analisis-desde">Desde</label>
            <input type="date" id="analisis-desde" />
          </div>
          <div class="kanm-input-group">
            <label for="analisis-hasta">Hasta</label>
            <input type="date" id="analisis-hasta" />
          </div>
          <div class="admin-report-actions">
            <button type="button" class="kanm-button" id="analisis-actualizar">Actualizar</button>
          </div>
        </div>
        <div id="analisis-mensaje" class="kanm-message"></div>
      </section>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>KPIs principales</h3>
          <p class="kanm-subtitle">Ingresos, gastos y utilidad real.</p>
        </header>
        <div class="admin-resumen-grid analisis-kpi-grid">
          <div class="resumen-metric">
            <span class="resumen-label">Ventas</span>
            <span class="resumen-value" id="analisis-kpi-ventas">DOP&nbsp;0.00</span>
            <span class="resumen-delta" id="analisis-kpi-ventas-delta"></span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Gastos</span>
            <span class="resumen-value" id="analisis-kpi-gastos">DOP&nbsp;0.00</span>
            <span class="resumen-delta" id="analisis-kpi-gastos-delta"></span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Ganancia neta</span>
            <span class="resumen-value" id="analisis-kpi-ganancia">DOP&nbsp;0.00</span>
            <span class="resumen-delta" id="analisis-kpi-ganancia-delta"></span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Utilidad real</span>
            <span class="resumen-value" id="analisis-kpi-utilidad-real">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Margen neto</span>
            <span class="resumen-value" id="analisis-kpi-margen">0%</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Ticket promedio</span>
            <span class="resumen-value" id="analisis-kpi-ticket">DOP&nbsp;0.00</span>
            <span class="resumen-delta" id="analisis-kpi-ticket-delta"></span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Cantidad de ventas</span>
            <span class="resumen-value" id="analisis-kpi-ventas-count">0</span>
          </div>
        </div>
        <div id="analisis-utilidad-real-aviso" class="kanm-message" data-type="warning" hidden></div>
      </section>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header analisis-avanzado-header">
          <div>
            <h3>Analisis avanzado (Caja, Inventario y Capital)</h3>
            <p class="kanm-subtitle">
              Separa compras de inventario, flujo de caja y capital inicial para una lectura mas real del negocio.
            </p>
          </div>
          <div class="analisis-avanzado-actions">
            <button type="button" class="kanm-button secondary" id="analisis-capital-abrir">
              Configurar capital inicial
            </button>
          </div>
        </header>
        <div class="admin-resumen-grid analisis-avanzado-grid">
          <div class="resumen-metric">
            <span class="resumen-label">Compras de inventario</span>
            <span class="resumen-value" id="analisis-adv-compras-inventario">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Gastos operativos reales</span>
            <span class="resumen-value" id="analisis-adv-gastos-operativos">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">COGS del periodo</span>
            <span class="resumen-value" id="analisis-adv-cogs-total">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Utilidad bruta</span>
            <span class="resumen-value" id="analisis-adv-utilidad-bruta">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Utilidad neta real</span>
            <span class="resumen-value" id="analisis-adv-utilidad-neta">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Flujo de caja (neto)</span>
            <span class="resumen-value" id="analisis-adv-flujo-caja">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Caja inicial</span>
            <span class="resumen-value" id="analisis-adv-caja-inicial">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Caja final estimada</span>
            <span class="resumen-value" id="analisis-adv-caja-final">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Inventario inicial</span>
            <span class="resumen-value" id="analisis-adv-inventario-inicial">DOP&nbsp;0.00</span>
          </div>
          <div class="resumen-metric">
            <span class="resumen-label">Inventario final estimado</span>
            <span class="resumen-value" id="analisis-adv-inventario-final">DOP&nbsp;0.00</span>
          </div>
        </div>
        <div id="analisis-capital-aviso" class="kanm-message" data-type="warning" hidden></div>
        <div id="analisis-avanzado-alertas" class="analisis-alertas"></div>
      </section>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>Serie diaria</h3>
          <p class="kanm-subtitle">Ventas, gastos y ganancia por dia.</p>
        </header>
        <div class="kanm-table-wrapper">
          <table class="kanm-table analisis-serie-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Ventas</th>
                <th>Gastos</th>
                <th>Ganancia</th>
              </tr>
            </thead>
            <tbody id="analisis-serie-body"></tbody>
          </table>
        </div>
      </section>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>Rankings de productos</h3>
          <p class="kanm-subtitle">Productos lideres y con baja rotacion.</p>
        </header>
        <div class="analisis-rankings-grid">
          <div>
            <h4>Top por cantidad</h4>
            <div class="analisis-ranking-list" id="analisis-top-cantidad"></div>
          </div>
          <div>
            <h4>Top por ingresos</h4>
            <div class="analisis-ranking-list" id="analisis-top-ingresos"></div>
          </div>
          <div>
            <h4>Bottom / Sin ventas</h4>
            <div class="analisis-ranking-list" id="analisis-bottom-productos"></div>
          </div>
        </div>
      </section>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>Patrones y horarios</h3>
          <p class="kanm-subtitle">Dias fuertes, horas pico y metodos de pago.</p>
        </header>
        <div class="analisis-insights-grid">
          <div>
            <h4>Top dias de semana</h4>
            <div class="analisis-ranking-list" id="analisis-top-dias"></div>
          </div>
          <div>
            <h4>Top horas</h4>
            <div class="analisis-ranking-list" id="analisis-top-horas"></div>
          </div>
          <div>
            <h4>Top dias del mes</h4>
            <div class="analisis-ranking-list" id="analisis-top-dias-mes"></div>
          </div>
          <div>
            <h4>Metodos de pago</h4>
            <div class="analisis-ranking-list" id="analisis-metodos-pago"></div>
          </div>
        </div>
      </section>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>Gastos por categoria</h3>
          <p class="kanm-subtitle">Categorias principales y gastos recurrentes.</p>
        </header>
        <div class="analisis-insights-grid">
          <div>
            <h4>Top categorias</h4>
            <div class="analisis-ranking-list" id="analisis-top-categorias"></div>
          </div>
          <div>
            <h4>Recurrentes vs no recurrentes</h4>
            <div class="analisis-ranking-list" id="analisis-gastos-recurrentes"></div>
          </div>
        </div>
      </section>

      <section class="kanm-card admin-card">
        <header class="kanm-card-header">
          <h3>Alertas e insights</h3>
          <p class="kanm-subtitle">Sugerencias accionables basadas en datos.</p>
        </header>
        <div id="analisis-alertas" class="analisis-alertas"></div>
      </section>
    </section>

    <!-- Cuadres -->
    <section class="admin-panel hidden" data-admin-section="cuadres" id="admin-section-cierres">
      <div class="kanm-card-header">
        <h2>Cuadres de caja</h2>
        <p class="kanm-subtitle">Consulta los cierres registrados y verifica diferencias declaradas.</p>
      </div>
      <section class="kanm-card admin-card">
        <div class="admin-report-controls">
          <div class="kanm-input-group">
            <label for="cierres-desde">Desde</label>
            <input type="date" id="cierres-desde" />
          </div>
          <div class="kanm-input-group">
            <label for="cierres-hasta">Hasta</label>
            <input type="date" id="cierres-hasta" />
          </div>
          <div class="admin-report-actions">
            <button type="button" class="kanm-button secondary" id="cierres-buscar">
              Buscar
            </button>
            <button type="button" class="kanm-button" id="cierres-exportar">
              Exportar cuadres (CSV)
            </button>
          </div>
        </div>
        <div id="cierres-mensaje" class="kanm-message"></div>
        <div class="kanm-table-wrapper">
          <table class="kanm-table">
            <thead>
              <tr>
                <th>Fecha operación</th>
                <th>Hora de cuadre</th>
                <th>Usuario</th>
                <th>Total sistema</th>
                <th>Total declarado</th>
                <th>Diferencia</th>
                <th>Observaciones</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="cierres-tabla"></tbody>
          </table>
        </div>
        <div class="kanm-table-wrapper" id="cierres-detalle-wrapper" hidden>
          <h3 class="kanm-subheading">Detalle del cierre seleccionado</h3>
          <table class="kanm-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Mesa/Cliente</th>
                <th>Total</th>
                <th>Fecha de cobro</th>
              </tr>
            </thead>
            <tbody id="cierres-detalle-tabla"></tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- Historial de preparación -->
    <section class="admin-panel hidden" data-admin-section="historial" id="admin-section-historial">
      <div class="kanm-card-header">
        <h2>Historial de preparación</h2>
        <p class="kanm-subtitle">Consulta los items finalizados agrupados por dia y area (Cocina/Bar).</p>
      </div>
      <section class="kanm-card admin-card">
        <div class="admin-report-controls">
          <div class="kanm-input-group">
            <label for="hist-cocina-fecha">Fecha</label>
            <input type="date" id="hist-cocina-fecha" />
          </div>
          <div class="kanm-input-group">
            <label for="hist-cocina-area">Área</label>
            <select id="hist-cocina-area">
              <option value="todas">Todas</option>
              <option value="cocina">Cocina</option>
              <option value="bar">Bar</option>
            </select>
          </div>
          <div class="kanm-input-group">
            <label for="hist-cocina-cocinero">Preparador</label>
            <select id="hist-cocina-cocinero">
              <option value="">Todos</option>
            </select>
          </div>
          <div class="admin-report-actions">
            <button type="button" class="kanm-button secondary" id="hist-cocina-buscar">Consultar</button>
            <button type="button" class="kanm-button" id="hist-cocina-exportar">Exportar a CSV</button>
          </div>
        </div>
        <div id="hist-cocina-mensaje" class="kanm-message"></div>
        <div class="kanm-table-wrapper">
          <table class="kanm-table">
            <thead>
              <tr>
                <th>Cuenta</th>
                <th>Pedido</th>
                <th>Ítem</th>
                <th>Cantidad</th>
                <th>Área</th>
                <th>Preparador</th>
                <th>Entrada</th>
                <th>Finalizado</th>
              </tr>
            </thead>
            <tbody id="hist-cocina-tabla"></tbody>
          </table>
        </div>
        <div class="kanm-pagination" id="hist-cocina-paginacion">
          <button type="button" class="kanm-button ghost" id="hist-cocina-prev">Anterior</button>
          <span class="kanm-pagination-info" id="hist-cocina-info">Página 1</span>
          <button type="button" class="kanm-button ghost" id="hist-cocina-next">Siguiente</button>
        </div>
      </section>
    </section>

    <!-- Negocios (solo super admin) -->
    <section class="admin-panel hidden" data-admin-section="negocios" id="kanm-negocios-section">
      <div class="kanm-card-header">
        <h2 data-negocio-titulo>Negocios</h2>
        <p class="kanm-subtitle">Administra los negocios del sistema (solo super admin).</p>
      </div>
      <div class="kanm-card admin-card">
      <div class="kanm-card-header kanm-card-header--actions">
        <div>
          <h3>Listado</h3>
          <p class="kanm-subtitle">Solo visible para Super Admin.</p>
        </div>
        <div class="kanm-negocios-actions">
          <div class="kanm-input-group">
            <input
              type="search"
              id="kanm-negocios-buscar"
              placeholder="Buscar negocio por nombre..."
            />
          </div>
          <button type="button" class="kanm-button primary" id="kanm-negocios-btn-nuevo">Nuevo negocio</button>
        </div>
      </div>
      <div id="kanm-negocios-mensaje" class="kanm-subtitle"></div>
        <div class="kanm-table-wrapper">
          <table class="kanm-table" id="kanm-negocios-tabla">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Slug</th>
                <th>Empresa</th>
                <th>Estado</th>
                <th>Colores</th>
                <th>Logo</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="kanm-negocios-tbody">
              <tr>
                <td colspan="7">Cargando...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal Crear/Editar Negocio -->
  <div class="kanm-modal oculto" id="kanm-negocios-modal">
    <div class="kanm-modal-backdrop"></div>
    <div class="kanm-modal-panel">
      <div class="kanm-modal-header">
        <h3 id="kanm-negocios-modal-titulo">Nuevo negocio</h3>
        <button type="button" class="kanm-button ghost" id="kanm-negocios-btn-cerrar">Cerrar</button>
      </div>
      <div class="kanm-modal-body">
        <form id="kanm-negocios-form" class="kanm-form" novalidate>
          <input type="hidden" id="kanm-negocios-id" />
          <section class="kanm-modal-section">
            <h4>Datos básicos</h4>
            <div class="kanm-input-group">
              <label for="kanm-negocios-nombre">Título / Nombre público</label>
              <input type="text" id="kanm-negocios-nombre" placeholder="Ej. Mi Cafetería" required />
            </div>
            <div class="kanm-input-group" id="kanm-negocios-slug-group">
              <label for="kanm-negocios-slug">Slug</label>
              <input type="text" id="kanm-negocios-slug" placeholder="mi-cafeteria" required />
            </div>
            <div class="kanm-input-group">
              <label for="kanm-negocios-empresa-nombre">Empresa</label>
              <input type="text" id="kanm-negocios-empresa-nombre" placeholder="Grupo empresarial" />
              <span class="kanm-input-help">Usa el mismo nombre para agrupar sucursales.</span>
            </div>
            <div class="kanm-input-group" id="kanm-negocios-empresa-select-group">
              <label for="kanm-negocios-empresa-select">Empresa existente</label>
              <select id="kanm-negocios-empresa-select">
                <option value="">Selecciona un grupo...</option>
              </select>
              <span class="kanm-input-help">
                Al elegir un grupo se copiará el tema visual y el logo de esa empresa.
              </span>
            </div>
            <div class="kanm-input-group">
              <label class="kanm-checkbox" for="kanm-negocios-tiene-sucursales">
                <input type="checkbox" id="kanm-negocios-tiene-sucursales" />
                <span>Este negocio tiene sucursales</span>
              </label>
              <span class="kanm-input-help">
                Si activas, se crea o se reutiliza el usuario empresa. Si ya existe, puedes dejar el usuario vacio.
              </span>
            </div>
            <div class="kanm-input-group">
              <label for="kanm-negocios-logo-url">Logo URL</label>
              <input type="text" id="kanm-negocios-logo-url" placeholder="https://..." />
            </div>
          </section>

          <section class="kanm-modal-section">
            <h4>Tema visual</h4>
            <div class="kanm-grid-2">
              <div class="kanm-input-group">
                <label for="kanm-negocios-color-primario">Color primario</label>
                <input type="color" id="kanm-negocios-color-primario" value="#255bc7" />
              </div>
              <div class="kanm-input-group">
                <label for="kanm-negocios-color-secundario">Color secundario</label>
                <input type="color" id="kanm-negocios-color-secundario" value="#7b8fb8" />
              </div>
            </div>
            <div class="kanm-grid-2">
              <div class="kanm-input-group">
                <label for="kanm-negocios-color-texto">Color texto</label>
                <input type="color" id="kanm-negocios-color-texto" value="#24344a" />
              </div>
              <div class="kanm-input-group">
                <label for="kanm-negocios-color-header">Color header</label>
                <input type="color" id="kanm-negocios-color-header" value="#255bc7" />
              </div>
            </div>
            <div class="kanm-grid-3">
              <div class="kanm-input-group">
                <label for="kanm-negocios-color-boton-primario">Color botón primario</label>
                <input type="color" id="kanm-negocios-color-boton-primario" value="#255bc7" />
              </div>
              <div class="kanm-input-group">
                <label for="kanm-negocios-color-boton-secundario">Color botón secundario</label>
                <input type="color" id="kanm-negocios-color-boton-secundario" value="#7b8fb8" />
              </div>
              <div class="kanm-input-group">
                <label for="kanm-negocios-color-boton-peligro">Color botón peligro</label>
                <input type="color" id="kanm-negocios-color-boton-peligro" value="#ff4b4b" />
              </div>
            </div>
          </section>

          <section class="kanm-modal-section">
            <h4>Módulos habilitados</h4>
            <div class="kanm-grid-3">
              <label class="kanm-checkbox">
                <input type="checkbox" id="kanm-modulo-admin" checked />
                <span>Admin</span>
              </label>
              <label class="kanm-checkbox">
                <input type="checkbox" id="kanm-modulo-mesera" checked />
                <span>Mesera</span>
              </label>
              <label class="kanm-checkbox">
                <input type="checkbox" id="kanm-modulo-cocina" checked />
                <span>Cocina</span>
              </label>
              <label class="kanm-checkbox">
                <input type="checkbox" id="kanm-modulo-bar" />
                <span>Bar</span>
              </label>
              <label class="kanm-checkbox">
                <input type="checkbox" id="kanm-modulo-caja" checked />
                <span>Caja</span>
              </label>
                <label class="kanm-checkbox">
                  <input type="checkbox" id="kanm-modulo-mostrador" checked />
                  <span>Mostrador</span>
                </label>
              <label class="kanm-checkbox">
                <input type="checkbox" id="kanm-modulo-historial" checked />
                <span>Historial de preparación</span>
              </label>
            </div>
          </section>

          <section class="kanm-modal-section">
            <h4 id="kanm-negocios-admin-titulo">Admin principal</h4>
          <div class="kanm-input-group">
            <label for="kanm-negocios-admin-correo" id="kanm-negocios-admin-correo-label">Correo del admin principal</label>
            <input type="email" id="kanm-negocios-admin-correo" placeholder="admin@negocio.com" />
          </div>
          <div class="kanm-grid-2">
            <div class="kanm-input-group">
              <label for="kanm-negocios-admin-usuario" id="kanm-negocios-admin-usuario-label">Usuario admin (opcional)</label>
              <input type="text" id="kanm-negocios-admin-usuario" placeholder="admin.negocio" />
              <span class="kanm-input-help" id="kanm-negocios-admin-usuario-help">
                Este usuario sera el admin principal del negocio.
              </span>
            </div>
            <div class="kanm-input-group kanm-input-group--inline kanm-input-toggle">
              <label class="kanm-checkbox" for="kanm-negocios-cambiar-password">
                <input type="checkbox" id="kanm-negocios-cambiar-password" />
                <span>Actualizar contrase?a</span>
              </label>
              <span class="kanm-input-help">Activa para definir una nueva contrase?a.</span>
            </div>
            <div class="kanm-input-group">
              <label for="kanm-negocios-admin-password" id="kanm-negocios-admin-password-label">
                Contrase?a admin (opcional)
              </label>
              <div class="password-field">
                <input
                  type="password"
                  id="kanm-negocios-admin-password"
                  placeholder="Deja vacio para mantener la actual"
                />
                <button
                  type="button"
                  class="password-toggle"
                  data-password-toggle
                  aria-pressed="false"
                  aria-label="Mostrar contrasena"
                >
                  Mostrar
                </button>
              </div>
              <span class="kanm-input-help" id="kanm-negocios-admin-password-help">
                Solo se aplica si activas "Actualizar contrase?a".
              </span>
            </div>
          </div>
        </section>

          <div class="kanm-modal-footer">
            <div id="kanm-negocios-form-mensaje" class="kanm-subtitle"></div>
            <button type="submit" class="kanm-button primary" id="kanm-negocios-btn-guardar">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>


  <!-- Modal Vista completa Productos -->
  <div class="kanm-modal oculto" id="kanm-productos-vista-modal">
    <div class="kanm-modal-backdrop"></div>
    <div class="kanm-modal-panel productos-vista-modal-panel">
      <div class="productos-vista-window">
        <div class="productos-vista-titlebar">
          <div class="productos-vista-titlebar-left">
            <div class="productos-vista-window-controls">
              <span class="productos-vista-dot"></span>
              <span class="productos-vista-dot"></span>
              <span class="productos-vista-dot"></span>
            </div>
            <div class="productos-vista-title">
              <h3>Productos (vista completa)</h3>
              <p class="kanm-subtitle">Ordena y filtra tu inventario en una sola vista.</p>
            </div>
          </div>
          <div class="productos-vista-actions">
            <button type="button" class="kanm-button ghost" id="productos-vista-cerrar">Cerrar</button>
          </div>
        </div>
        <div class="productos-vista-body">
          <aside class="productos-vista-sidebar">
            <div class="productos-vista-controls">
              <div class="kanm-input-group">
                <label for="productos-vista-buscar">Buscar</label>
                <input type="text" id="productos-vista-buscar" placeholder="Buscar producto..." />
              </div>
              <div class="kanm-input-group">
                <label for="productos-vista-categoria">Categoria</label>
                <select id="productos-vista-categoria">
                  <option value="">Todas las categorías</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="productos-vista-tipo">Tipo</label>
                <select id="productos-vista-tipo">
                  <option value="">Todos</option>
                  <option value="insumo">Insumos</option>
                  <option value="vendible">Productos vendibles</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="productos-vista-orden">Orden</label>
                <select id="productos-vista-orden">
                  <option value="nombre-asc">Nombre (A-Z)</option>
                  <option value="nombre-desc">Nombre (Z-A)</option>
                  <option value="costo-desc">Costo mayor a menor</option>
                  <option value="costo-asc">Costo menor a mayor</option>
                </select>
              </div>
            </div>
          </aside>
          <section class="productos-vista-content">
            <div id="productos-vista-lista" class="productos-vista-grid"></div>
          </section>
        </div>
      </div>
    </div>
  </div>


  <!-- Modal Facturacion POSIUM -->
  <div class="kanm-modal oculto" id="kanm-facturacion-modal">
    <div class="kanm-modal-backdrop"></div>
    <div class="kanm-modal-panel kanm-modal-panel--wide">
      <div class="kanm-modal-header">
        <h3 id="kanm-facturacion-modal-titulo">Facturacion POSIUM</h3>
        <button type="button" class="kanm-button ghost" id="kanm-facturacion-btn-cerrar">Cerrar</button>
      </div>
      <div class="kanm-modal-body">
        <form id="kanm-facturacion-form" class="kanm-form" novalidate>
          <input type="hidden" id="kanm-facturacion-negocio-id" />
          <p class="kanm-subtitle" id="kanm-facturacion-negocio-nombre"></p>

          <section class="kanm-modal-section">
            <h4>Cliente</h4>
            <div class="kanm-grid-2">
              <div class="kanm-input-group">
                <label for="facturacion-cliente-nombre">Razon social / Nombre comercial</label>
                <input type="text" id="facturacion-cliente-nombre" placeholder="Cliente" />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-cliente-rnc">RNC o Cedula</label>
                <input type="text" id="facturacion-cliente-rnc" placeholder="RNC/Cedula" />
              </div>
            </div>
            <div class="kanm-grid-2">
              <div class="kanm-input-group">
                <label for="facturacion-cliente-direccion">Direccion</label>
                <input type="text" id="facturacion-cliente-direccion" placeholder="Direccion del cliente" />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-cliente-telefono">Telefono</label>
                <input type="text" id="facturacion-cliente-telefono" placeholder="Telefono" />
              </div>
            </div>
            <div class="kanm-grid-2">
              <div class="kanm-input-group">
                <label for="facturacion-cliente-email">Email</label>
                <input type="email" id="facturacion-cliente-email" placeholder="correo@cliente.com" />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-cliente-contacto">Contacto</label>
                <input type="text" id="facturacion-cliente-contacto" placeholder="Nombre contacto" />
              </div>
            </div>
          </section>

          <section class="kanm-modal-section">
            <h4>Emisor (POSIUM)</h4>
            <div class="kanm-grid-2">
              <div class="kanm-input-group">
                <label for="facturacion-emisor-nombre">Nombre comercial</label>
                <input type="text" id="facturacion-emisor-nombre" placeholder="POSIUM" />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-emisor-rnc">RNC</label>
                <input type="text" id="facturacion-emisor-rnc" placeholder="RNC" />
              </div>
            </div>
            <div class="kanm-grid-2">
              <div class="kanm-input-group">
                <label for="facturacion-emisor-direccion">Direccion</label>
                <input type="text" id="facturacion-emisor-direccion" placeholder="Direccion" />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-emisor-telefono">Telefono</label>
                <input type="text" id="facturacion-emisor-telefono" placeholder="Telefono" />
              </div>
            </div>
            <div class="kanm-grid-2">
              <div class="kanm-input-group">
                <label for="facturacion-emisor-email">Email</label>
                <input type="email" id="facturacion-emisor-email" placeholder="correo@posium.com" />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-emisor-logo">Logo (URL)</label>
                <input type="text" id="facturacion-emisor-logo" placeholder="https://..." />
              </div>
            </div>
            <div class="kanm-input-group">
              <label for="facturacion-emisor-nota">Nota/pie de factura</label>
              <textarea id="facturacion-emisor-nota" rows="2" placeholder="Gracias por su preferencia"></textarea>
            </div>
          </section>

          <section class="kanm-modal-section">
            <h4>Plan y configuracion</h4>
            <div class="kanm-grid-3">
              <div class="kanm-input-group">
                <label for="facturacion-plan-nombre">Plan/paquete</label>
                <input type="text" id="facturacion-plan-nombre" placeholder="Suscripcion POSIUM mensual" />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-precio-base">Precio base</label>
                <input type="text" id="facturacion-precio-base" inputmode="decimal" data-money placeholder="0.00" />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-moneda">Moneda</label>
                <select id="facturacion-moneda">
                  <option value="RD$">RD$</option>
                  <option value="USD">USD</option>
                </select>
              </div>
            </div>
            <div class="kanm-grid-3">
              <div class="kanm-input-group">
                <label for="facturacion-impuesto-tipo">Impuesto</label>
                <select id="facturacion-impuesto-tipo">
                  <option value="porcentaje">ITBIS %</option>
                  <option value="fijo">Monto fijo</option>
                </select>
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-impuesto-valor">Valor impuesto</label>
                <input
                  type="text"
                  id="facturacion-impuesto-valor"
                  inputmode="decimal"
                  data-money
                  placeholder="0.00"
                />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-periodo-default">Periodo por defecto</label>
                <input type="text" id="facturacion-periodo-default" placeholder="Enero 2026" />
              </div>
            </div>
            <div class="kanm-grid-2">
              <div class="kanm-input-group">
                <label for="facturacion-terminos">Terminos de pago</label>
                <input type="text" id="facturacion-terminos" placeholder="Pago inmediato" />
              </div>
              <div class="kanm-input-group">
                <label for="facturacion-metodo">Metodo de pago</label>
                <select id="facturacion-metodo">
                  <option value="Transferencia">Transferencia</option>
                  <option value="Efectivo">Efectivo</option>
                  <option value="Tarjeta">Tarjeta</option>
                </select>
              </div>
            </div>
            <div class="kanm-input-group">
              <label for="facturacion-notas">Notas internas</label>
              <textarea id="facturacion-notas" rows="2" placeholder="Notas internas"></textarea>
            </div>
          </section>

          <section class="kanm-modal-section">
            <h4>Factura</h4>
            <div class="kanm-grid-3">
              <div class="kanm-input-group">
                <label for="factura-fecha-emision">Fecha de emision</label>
                <input type="date" id="factura-fecha-emision" />
              </div>
              <div class="kanm-input-group">
                <label for="factura-periodo">Periodo facturado</label>
                <input type="text" id="factura-periodo" placeholder="Enero 2026" />
              </div>
              <div class="kanm-input-group">
                <label for="factura-estado">Estado</label>
                <select id="factura-estado">
                  <option value="pendiente">Pendiente</option>
                  <option value="pagada">Pagada</option>
                  <option value="anulada">Anulada</option>
                </select>
              </div>
            </div>
            <div class="kanm-input-group">
              <label for="factura-descripcion">Descripcion</label>
              <input type="text" id="factura-descripcion" placeholder="Suscripcion POSIUM" />
            </div>
            <div class="kanm-grid-3">
              <div class="kanm-input-group">
                <label for="factura-cantidad">Cantidad</label>
                <input type="number" step="1" min="1" id="factura-cantidad" value="1" />
              </div>
              <div class="kanm-input-group">
                <label for="factura-precio-unitario">Precio unitario</label>
                <input
                  type="text"
                  id="factura-precio-unitario"
                  inputmode="decimal"
                  data-money
                  placeholder="0.00"
                />
              </div>
              <div class="kanm-input-group">
                <label for="factura-descuento">Descuento</label>
                <input type="text" id="factura-descuento" inputmode="decimal" data-money value="0" />
              </div>
            </div>
          </section>

          <section class="kanm-modal-section facturacion-resumen">
            <h4>Resumen</h4>
            <div class="facturacion-resumen-grid">
              <div class="facturacion-resumen-item">
                <span>Subtotal</span>
                <strong id="facturacion-resumen-subtotal">RD$0.00</strong>
              </div>
              <div class="facturacion-resumen-item">
                <span>ITBIS</span>
                <strong id="facturacion-resumen-itbis">RD$0.00</strong>
              </div>
              <div class="facturacion-resumen-item">
                <span>Descuento</span>
                <strong id="facturacion-resumen-descuento">RD$0.00</strong>
              </div>
              <div class="facturacion-resumen-item total">
                <span>Total</span>
                <strong id="facturacion-resumen-total">RD$0.00</strong>
              </div>
            </div>
          </section>

          <div class="kanm-modal-footer">
            <div id="facturacion-mensaje" class="kanm-message"></div>
            <div class="kanm-modal-actions">
              <button type="button" class="kanm-button secondary" id="facturacion-guardar-config">Guardar configuracion</button>
              <button type="button" class="kanm-button" id="facturacion-generar">Generar factura</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Historial Facturas POSIUM -->
  <div class="kanm-modal oculto" id="kanm-facturacion-historial-modal">
    <div class="kanm-modal-backdrop"></div>
    <div class="kanm-modal-panel kanm-modal-panel--wide">
      <div class="kanm-modal-header">
        <h3>Historial de facturas POSIUM</h3>
        <button type="button" class="kanm-button ghost" id="kanm-facturacion-historial-cerrar">Cerrar</button>
      </div>
      <div class="kanm-modal-body">
        <div class="kanm-modal-actions kanm-modal-actions--between">
          <span class="kanm-subtitle" id="facturacion-historial-titulo"></span>
          <button type="button" class="kanm-button ghost" id="facturacion-historial-recargar">Recargar</button>
        </div>
        <div id="facturacion-historial-mensaje" class="kanm-message"></div>
        <div class="kanm-table-wrapper">
          <table class="kanm-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Fecha</th>
                <th>Periodo</th>
                <th>Total</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="facturacion-historial-body"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="kanm-modal-overlay" id="analisis-capital-modal" hidden>
    <div class="kanm-modal" role="dialog" aria-modal="true" aria-labelledby="analisis-capital-titulo">
      <div class="kanm-modal-header">
        <h3 id="analisis-capital-titulo">Configurar capital inicial</h3>
        <button type="button" class="kanm-button ghost" id="analisis-capital-cerrar">Cerrar</button>
      </div>
      <div class="kanm-modal-body">
        <div class="analisis-capital-grid">
          <div class="kanm-input-group">
            <label for="analisis-capital-desde">Periodo inicio</label>
            <input type="date" id="analisis-capital-desde" />
          </div>
          <div class="kanm-input-group">
            <label for="analisis-capital-hasta">Periodo fin</label>
            <input type="date" id="analisis-capital-hasta" />
          </div>
          <div class="kanm-input-group">
            <label for="analisis-capital-caja">Caja inicial (RD$)</label>
            <input type="text" id="analisis-capital-caja" inputmode="decimal" data-money placeholder="0.00" />
          </div>
          <div class="kanm-input-group">
            <label for="analisis-capital-inventario">Inventario inicial (RD$)</label>
            <input
              type="text"
              id="analisis-capital-inventario"
              inputmode="decimal"
              data-money
              placeholder="0.00"
            />
          </div>
          <div class="kanm-input-group">
            <label for="analisis-cogs-estimado">Costo estimado por unidad</label>
            <input type="text" id="analisis-cogs-estimado" inputmode="decimal" data-money placeholder="0.00" />
            <span class="kanm-input-help">Se usa si no hay costo real en inventario.</span>
          </div>
        </div>
        <div id="analisis-capital-mensaje" class="kanm-message"></div>
      </div>
      <div class="kanm-modal-actions">
        <button type="button" class="kanm-button ghost" id="analisis-capital-cancelar">Cancelar</button>
        <button type="button" class="kanm-button" id="analisis-capital-guardar">Guardar capital</button>
      </div>
    </div>
  </div>

  <div class="kanm-modal-overlay" id="admin-eliminar-modal" hidden>
    <div class="kanm-modal" role="dialog" aria-modal="true" aria-labelledby="admin-eliminar-titulo">
      <h3 id="admin-eliminar-titulo">Eliminar registro</h3>
      <p id="admin-eliminar-descripcion">
        Esta acción es irreversible. Confirma la eliminación del registro seleccionado.
      </p>
      <div class="kanm-input-group">
        <label for="admin-eliminar-password">Contraseña de administrador</label>
        <div class="password-field">
          <input
            type="password"
            id="admin-eliminar-password"
            placeholder="Ingresa la contraseña"
            autocomplete="current-password"
          />
          <button
            type="button"
            class="password-toggle"
            data-password-toggle
            aria-pressed="false"
            aria-label="Mostrar contrasena"
          >
            Mostrar
          </button>
        </div>
      </div>
      <div class="kanm-modal-actions">
        <button type="button" class="kanm-button ghost" id="admin-eliminar-cancelar">Cancelar</button>
        <button type="button" class="kanm-button danger" id="admin-eliminar-confirmar">Eliminar</button>
      </div>
      <div id="admin-eliminar-mensaje" class="kanm-message"></div>
    </div>
  </div>

  <div class="kanm-modal-overlay" id="empresa-usuario-modal" hidden>
    <div class="kanm-modal" role="dialog" aria-modal="true" aria-labelledby="empresa-usuario-titulo">
      <h3 id="empresa-usuario-titulo">Crear usuario empresa</h3>
      <p class="kanm-subtitle" id="empresa-usuario-subtitulo">Empresa: --</p>
      <div class="kanm-input-group">
        <label for="empresa-usuario-nombre">Nombre</label>
        <input type="text" id="empresa-usuario-nombre" placeholder="Nombre del usuario empresa" />
      </div>
      <div class="kanm-input-group">
        <label for="empresa-usuario-usuario">Usuario</label>
        <input type="text" id="empresa-usuario-usuario" placeholder="usuario.empresa" />
      </div>
      <div class="kanm-input-group">
        <label for="empresa-usuario-password">Contraseña</label>
        <div class="password-field">
          <input type="password" id="empresa-usuario-password" placeholder="Contraseña" autocomplete="new-password" />
          <button type="button" class="password-toggle" data-password-toggle aria-pressed="false">
            Mostrar
          </button>
        </div>
      </div>
      <div class="kanm-modal-actions">
        <button type="button" class="kanm-button ghost" id="empresa-usuario-cancelar">Cancelar</button>
        <button type="button" class="kanm-button primary" id="empresa-usuario-guardar">Crear usuario</button>
      </div>
      <div id="empresa-usuario-mensaje" class="kanm-message"></div>
    </div>
  </div>

  <script src="/js/password-toggle.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/admin.js"></script>
  <script src="/js/supervisor.js"></script>
  <script src="/js/admin-facturacion-posium.js"></script>
  <script src="/js/admin-cotizaciones.js"></script>
  <script src="/js/admin-clientes.js"></script>
  <script src="/js/admin-categorias.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/notifications.js" defer></script>
</body>
</html>



